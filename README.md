# cert-manager

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Cloudflare API –∏ wildcard-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–æ–ª—É—á–µ–Ω–∏–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** —á–µ—Ä–µ–∑ Let's Encrypt
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Cloudflare API** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è wildcard-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π ACME-–≤—ã–∑–æ–≤** –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ cron
- **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ PEM-—Ñ–∞–π–ª–æ–≤** –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å HAProxy –∏ –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ö—É–∫–∏** –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–ª—É–∂–± –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞** —Å GitHub

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–û–°**: Ubuntu 22.04 (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)
- **–ü—Ä–∞–≤–∞**: root –∏–ª–∏ sudo –¥–æ—Å—Ç—É–ø
- **–ü–æ—Ä—Ç 80**: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–ª—è ACME-–≤—ã–∑–æ–≤–æ–≤ (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞–∫–µ—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:
- `certbot` - –∫–ª–∏–µ–Ω—Ç Let's Encrypt
- `python3-certbot-dns-cloudflare` - –ø–ª–∞–≥–∏–Ω Cloudflare –¥–ª—è Certbot
- `ufw` - —É—Ç–∏–ª–∏—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π—Ä–≤–æ–ª–æ–º
- `curl` - –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
- `dnsutils` - –¥–ª—è DNS-–∑–∞–ø—Ä–æ—Å–æ–≤ (–∫–æ–º–∞–Ω–¥–∞ dig)
- `cron` - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
bash <(curl -Ls https://raw.githubusercontent.com/xxphantom/cert-manager/main/install.sh)
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Å–∏—Å—Ç–µ–º—É
–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ —Å–∏—Å—Ç–µ–º—É:
```bash
# –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é "9. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç"
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
sudo ./install.sh install
```

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ:
```bash
cert-manager
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –µ–≥–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å GitHub:
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
sudo cert-manager
# –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ "9. –û–±–Ω–æ–≤–∏—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç"
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é:
```bash
sudo cert-manager
```

### –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
–°–∫—Ä–∏–ø—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo cert-manager status

# –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
sudo cert-manager get

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo cert-manager renew

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ö—É–∫–∏ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤
sudo cert-manager sethook

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ —Å–∏—Å—Ç–µ–º–µ
sudo cert-manager install
```

## üìñ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

#### Cloudflare API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ wildcard-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** (*.example.com)
- **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è DNS-–≤–∞–ª–∏–¥–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Cloudflare API
- **ECDSA-–∫–ª—é—á–∏** —Å –∫—Ä–∏–≤–æ–π secp384r1 –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –î–æ–º–µ–Ω –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DNS Cloudflare
- API-—Ç–æ–∫–µ–Ω Cloudflare —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DNS

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –í–≤–µ–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `example.com`)
2. –í–≤–µ–¥–∏—Ç–µ email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Let's Encrypt
3. –í–≤–µ–¥–∏—Ç–µ API-—Ç–æ–∫–µ–Ω Cloudflare
4. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è `example.com` –∏ `*.example.com`

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π ACME
- **HTTP-01 –≤–∞–ª–∏–¥–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç 80
- **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤** –±–µ–∑ wildcard
- **–¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞ 80** –∏–∑–≤–Ω–µ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü–æ—Ä—Ç 80/tcp –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- –î–æ–º–µ–Ω –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç cron-–∑–∞–¥–∞—á—É –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:
```bash
0 4 * * * /usr/bin/certbot renew --quiet
```

### 3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ PEM-—Ñ–∞–π–ª–æ–≤

–î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å HAProxy, –∏ –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏, —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `full.pem`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (`privkey.pem`)
- –ü–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (`fullchain.pem`)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:**
```
/etc/letsencrypt/live/example.com/
‚îú‚îÄ‚îÄ privkey.pem      # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
‚îú‚îÄ‚îÄ fullchain.pem    # –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ full.pem         # –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—É–∫–æ–≤

–•—É–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–ª—É–∂–±—ã –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

**–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ —Ö—É–∫–æ–≤:**
```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx
systemctl reload nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker restart my_container
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π deploy-—Ö—É–∫:**
–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π deploy-—Ö—É–∫ –≤ `/etc/letsencrypt/renewal-hooks/deploy/01-cert-manager-pem-combiner`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ PEM-—Ñ–∞–π–ª—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞.

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

–°–∫—Ä–∏–ø—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å GitHub:

**–ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
1. –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ –æ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ
2. –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
3. –°–∫–∞—á–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é —Å GitHub
4. –ó–∞–º–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏



## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Cloudflare:**
```
/etc/letsencrypt/cloudflare/credentials.ini
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–≤:**
```
/etc/letsencrypt/renewal/example.com.conf
```

**Deploy-—Ö—É–∫ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è PEM:**
```
/etc/letsencrypt/renewal-hooks/deploy/01-cert-manager-pem-combiner
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç—É—Å

–§—É–Ω–∫—Ü–∏—è "–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:
- **–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤** —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
- **–ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–ª—é—á–µ–π
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è** —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π:
  - üî¥ –ö—Ä–∞—Å–Ω—ã–π: –º–µ–Ω–µ–µ 14 –¥–Ω–µ–π
  - üü° –ñ–µ–ª—Ç—ã–π: –º–µ–Ω–µ–µ 30 –¥–Ω–µ–π
  - üü¢ –ó–µ–ª–µ–Ω—ã–π: –±–æ–ª–µ–µ 30 –¥–Ω–µ–π
- **–ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ö—É–∫–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞
- **–°—Ç–∞—Ç—É—Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤** full.pem

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –°–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç root-–ø—Ä–∞–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- –§–∞–π–ª—ã —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Cloudflare –∏–º–µ—é—Ç –ø—Ä–∞–≤–∞ 600 (—Ç–æ–ª—å–∫–æ root)
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ root

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- **ECDSA-–∫–ª—é—á–∏** —Å –∫—Ä–∏–≤–æ–π secp384r1
- **–ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å RSA –ø—Ä–∏ –º–µ–Ω—å—à–µ–º —Ä–∞–∑–º–µ—Ä–µ –∫–ª—é—á–∞
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è** –≤—Å–µ–º–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏ –∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ 80 —á–µ—Ä–µ–∑ UFW:
```bash
# –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 80 –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
sudo ufw allow 80/tcp
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
–ß—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞, —Å–∫—Ä–∏–ø—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç IP —Å–µ—Ä–≤–µ—Ä–∞ —Å IP –¥–æ–º–µ–Ω–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP –¥–æ–º–µ–Ω–∞
dig +short A example.com

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP —Å–µ—Ä–≤–µ—Ä–∞
curl -s -4 ifconfig.me
```

### –õ–æ–≥–∏ Certbot
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Certbot
sudo tail -f /var/log/letsencrypt/letsencrypt.log

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo certbot renew --dry-run
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ cron-–∑–∞–¥–∞—á
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä cron-–∑–∞–¥–∞—á root
sudo crontab -l

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã cron
sudo systemctl status cron
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ "Port 80 closed"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å UFW
sudo ufw status

# –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 80
sudo ufw allow 80/tcp

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Ä—Ç –Ω–µ –∑–∞–Ω—è—Ç
sudo netstat -tlnp | grep :80
```

### –û—à–∏–±–∫–∞ Cloudflare API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API-—Ç–æ–∫–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DNS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DNS Cloudflare

### –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
sudo certbot renew --force-renewal --verbose

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo cat /etc/letsencrypt/renewal/example.com.conf
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–µ–Ω–∏–µ wildcard-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è Nginx
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç: `sudo bash <(curl -fsSL https://raw.githubusercontent.com/xxphantom/cert-manager/main/install.sh)` –∏–ª–∏ `sudo cert-manager` (–µ—Å–ª–∏ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
2. –í—ã–±–µ—Ä–∏—Ç–µ "2. –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
3. –í—ã–±–µ—Ä–∏—Ç–µ "1. Cloudflare API"
4. –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω: `example.com`
5. –í–≤–µ–¥–∏—Ç–µ email –∏ API-—Ç–æ–∫–µ–Ω Cloudflare
6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ö—É–∫: `systemctl reload nginx`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è HAProxy
–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª:
```
# –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ HAProxy
bind *:443 ssl crt /etc/letsencrypt/live/example.com/full.pem
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ö—É–∫ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
# –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ö—É–∫–∞
docker restart my_web_container
```

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `/var/log/letsencrypt/letsencrypt.log`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `sudo cert-manager status`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron-–∑–∞–¥–∞—á–∏: `sudo crontab -l`
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `sudo certbot renew --dry-run`

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏.
